var ViewDatas=function(){var a=this;this.games=[101,301,501],this.gameIndex=1,this.players=ko.observableArray([]),this.thrown=ko.observable(0),this.scoreAtStepIn=a.games[a.gameIndex],this.currentPlayerIndex=0,this.nextPlayerToThrowFirst=1,this.jumpToNextPlayer=function(b){var c;b.avg((b.sum/b.throwsNum*3).toFixed(2)),c=a.currentPlayerIndex+1,c>=a.players().length&&(c=0),a.thrown(0),b.status(0),nextInLine=a.players()[c],nextInLine.status(1),a.scoreAtStepIn=nextInLine.score(),a.currentPlayerIndex=c},this.handleThrow=function(b){var c;c=a.players()[a.currentPlayerIndex],0==a.thrown()&&(c.lastScore=0),c.sum=parseInt(c.sum)+parseInt(b),c.throwsNum++,c.lastScore+=parseInt(b),c.score()-b<0?(c.score(a.scoreAtStepIn),a.jumpToNextPlayer(c)):c.score()-b==0?a.winner(c):(c.score(c.score()-b),2==a.thrown()?a.jumpToNextPlayer(c):a.thrown(a.thrown()+1))},this.winner=function(b){ko.utils.arrayForEach(a.players(),function(b){b.score(a.games[a.gameIndex]),b.status(2)}),a.thrown(0),a.currentPlayerIndex=a.nextPlayerToThrowFirst,a.players()[a.currentPlayerIndex].status(1),a.nextPlayerToThrowFirst++,a.nextPlayerToThrowFirst>=a.players().length&&(a.nextPlayerToThrowFirst=0),b.victories(b.victories()+1)},this.swapScore=function(){a.gameIndex++,a.gameIndex>=a.games.length&&(a.gameIndex=0),ko.utils.arrayForEach(a.players(),function(b){b.score(a.games[a.gameIndex]),b.status(2)})},this.undo=function(){var b;0==a.thrown()?(a.getCurrentPlayer().status(2),a.currentPlayerIndex--,a.currentPlayerIndex<0&&(a.currentPlayerIndex=a.players().length-1),b=a.getCurrentPlayer().score()+a.getCurrentPlayer().lastScore,a.getCurrentPlayer().score(b)):(a.getCurrentPlayer().score(a.scoreAtStepIn),a.thrown(0)),a.getCurrentPlayer().status(1)},this.getCurrentPlayer=function(){return a.players()[a.currentPlayerIndex]}},playerModel=function(a,b,c,d){this.name=a,this.status=ko.observable(b),this.score=ko.observable(c),this.victories=ko.observable(d||0),this.avg=ko.observable(0),this.throwsNum=0,this.sum=0,this.lastScore=0},viewDatas=new ViewDatas;ko.bindingHandlers.status={update:function(a,b,c,d,e){var f=b(),g=ko.unwrap(f);1==g?$(a).css("background-color","#AFE1AB"):0==g?$(a).css("background-color",""):$(a).css("background-color","")}},$(function(){var a;ko.applyBindings({players:viewDatas.players,thrown:viewDatas.thrown}),a=viewDatas.games[viewDatas.gameIndex],viewDatas.players.push(new playerModel("Eszti",1,a)),viewDatas.players.push(new playerModel("BalÃ¡zs",2,a)),viewDatas.players.push(new playerModel("Csaba",2,a)),$("#zero").click(function(){viewDatas.handleThrow(0)}),$("#up").click(function(){viewDatas.swapScore()}),$("#undo").click(function(){viewDatas.undo()}),$("#dartboard #areas g").children().click(function(){var a,b,c,d=this;a=$(this).attr("id"),c=$(this).css("fill"),$(this).css("fill","yellow"),setTimeout(function(){$(d).css("fill",c)},250),b=a.substring(1),"d"==a[0]&&(b=2*b),"t"==a[0]&&(b=3*b),"Outer"==a&&(b=25),"Bull"==a&&(b=50),viewDatas.handleThrow(b)})});