var ViewDatas=function(){var a=this;this.games=[101,301,501],this.gameIndex=1,this.players=ko.observableArray([]),this.thrown=ko.observable(0),this.highestGameShot=ko.observableArray([0,""]),this.switchViewIndex=ko.observable(0),this.currentPlayerIndex=0,this.nextPlayerToThrowFirst=1,this.jumpToNextPlayer=function(b){var c,d=b.history().reduce(function(a,b){return a+b},0);b.avg((d/b.history().length*3).toFixed(2)),b.require=b.score(),c=a.currentPlayerIndex+1,c>=a.players().length&&(c=0),a.thrown(0),b.status(0),nextInLine=a.players()[c],nextInLine.status(1),a.currentPlayerIndex=c},this.handleThrow=function(b){var c;c=a.getCurrentPlayer(),c.history.push(parseInt(b)),c.score()<0?(a.thrown(a.thrown()+1),c.history.splice(0-a.thrown(),a.thrown()),a.jumpToNextPlayer(c)):0==c.score()?a.winner(c):2==a.thrown()?a.jumpToNextPlayer(c):a.thrown(a.thrown()+1)},this.winner=function(b){return 1==a.players().length?void b.victories(b.victories()+1):(ko.utils.arrayForEach(a.players(),function(a){a.status(2),a.history([])}),a.highestGameShot()[0]<b.require&&a.highestGameShot([b.require,b.name]),a.thrown(0),a.currentPlayerIndex=a.nextPlayerToThrowFirst,a.players()[a.currentPlayerIndex].status(1),a.nextPlayerToThrowFirst++,a.nextPlayerToThrowFirst>=a.players().length&&(a.nextPlayerToThrowFirst=0),void b.victories(b.victories()+1))},this.swapScore=function(){a.gameIndex++,a.gameIndex>=a.games.length&&(a.gameIndex=0),ko.utils.arrayForEach(a.players(),function(a){a.status(2),a.history([])})},this.switchView=function(){var b=$("#switchable")[0].getAttribute("href");"styles/view.css"==b?(b="styles/main.css",a.switchViewIndex(0)):"styles/main.css"==b&&(b="styles/view.css",a.switchViewIndex(1));var c=($("#switchable")[0].getAttribute("href"),document.getElementById("switchable"));c.href=b,console.log(b)},this.undo=function(){0==a.thrown()?(a.getCurrentPlayer().status(2),a.currentPlayerIndex--,a.currentPlayerIndex<0&&(a.currentPlayerIndex=a.players().length-1),a.getCurrentPlayer().history.splice(-3,3)):(a.getCurrentPlayer().history.splice(0-a.thrown(),a.thrown()),a.thrown(0)),a.getCurrentPlayer().status(1)},this.getCurrentPlayer=function(){return a.players()[a.currentPlayerIndex]}},viewDatas=new ViewDatas,playerModel=function(a,b,c,d){this.name=a,this.status=ko.observable(b),this.victories=ko.observable(d||0);var e=0;this.avg=ko.observable(e.toFixed(3)),this.history=ko.observableArray([]),this.require=c,this.score=ko.computed(function(){return viewDatas.games[viewDatas.gameIndex]-this.history().reduce(function(a,b){return a+b},0)},this)};ko.bindingHandlers.status={update:function(a,b,c,d,e){var f=b(),g=ko.unwrap(f);1==g?$(a).css("background-color","#AFE1AB"):0==g?$(a).css("background-color",""):$(a).css("background-color","")}},$(function(){var a;ko.applyBindings({players:viewDatas.players,thrown:viewDatas.thrown,_switch:viewDatas.switchViewIndex,highestGameShot:viewDatas.highestGameShot}),a=viewDatas.games[viewDatas.gameIndex],viewDatas.players.push(new playerModel("BalÃ¡zs",1,a)),viewDatas.players.push(new playerModel("Csaba",2,a)),$("#switch-btn").click(function(){viewDatas.switchView()}),$("#zero").click(function(){viewDatas.handleThrow(0)}),$("#up").click(function(){viewDatas.swapScore()}),$("#undo").click(function(){viewDatas.undo()}),$("#dartboard #areas g").children().click(function(){var a,b,c,d=this;a=$(this).attr("id"),c=$(this).css("fill"),$(this).css("fill","yellow"),setTimeout(function(){$(d).css("fill",c)},250),b=a.substring(1),"d"==a[0]&&(b=2*b),"t"==a[0]&&(b=3*b),"Outer"==a&&(b=25),"Bull"==a&&(b=50),viewDatas.handleThrow(b)})});